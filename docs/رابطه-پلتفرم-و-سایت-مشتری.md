# رابطهٔ saas-platform و customer-site — راهنمای مرحله‌به‌مرحله

## نقش هر پروژه

| پروژه | نقش |
|--------|-----|
| **saas-platform** | پنل **مدیر اصلی**. همهٔ سایت‌های مشتری از اینجا مدیریت می‌شوند: ثبت سایت، صدور لایسنس، تعیین ماژول‌ها، تنظیمات ظاهری (رنگ، فونت، لوگو)، و غیره. |
| **customer-site** | یکی از **سایت‌های زیرمجموعه**. محتوا (صفحات، وبلاگ، فروشگاه) را خود مشتری مدیریت می‌کند؛ ولی **لایسنس، ظاهر، و (در آینده) ماژول‌ها** از پلتفرم می‌گیرد. |

یعنی: **منبع حقیقت** برای «سایت چیست و چه امکاناتی دارد» فقط **saas-platform** است؛ customer-site مصرف‌کنندهٔ آن تنظیمات است.

---

## مرحله ۱: ثبت سایت مشتری در پلتفرم

1. وارد **saas-platform** شوید: `http://saas-platform.test` (یا آدرس پنل خودتان).
2. از منو بروید به **سایت‌ها** و یک **سایت جدید** اضافه کنید.
3. فیلدها را پر کنید، از جمله:
   - **عنوان**: مثلاً «سایت شرکتی نمونه»
   - **دامنه**: همان دامنه‌ای که customer-site روی آن بالا است، مثلاً `customer-site.test`
4. سایت را **فعال** نگه دارید (is_active).

بدون این مرحله، لایسنس و تنظیمات UX برای این دامنه از API برنمی‌گردد.

---

## مرحله ۲: صدور لایسنس برای این سایت

1. در پلتفرم، وارد همان **سایت** شوید (یا بخش لایسنس/سایت).
2. برای این سایت یک **لایسنس** صادر کنید و **دامنه** را همان `customer-site.test` (یا دامنهٔ واقعی) بگذارید.
3. **کلید لایسنس** را کپی کنید (معمولاً فقط یک‌بار نمایش داده می‌شود).

این کلید را در مرحلهٔ بعد در سایت مشتری وارد می‌کنید.

---

## مرحله ۳: فعال‌سازی لایسنس در سایت مشتری

1. در **customer-site** با کاربر ادمین وارد شوید و بروید به **لایسنس** (از منوی سمت راست).
2. **کلید لایسنس** و در صورت نیاز **دامنه** (مثلاً `customer-site.test`) را وارد کنید و ذخیره کنید.
3. اگر پلتفرم در دسترس و لایسنس معتبر باشد، پیام موفقیت می‌بینید و فیلدهای **ماژول‌های فعال** و **انقضای پشتیبانی** از API پر می‌شوند.

توجه: در **.env** سایت مشتری حتماً `PLATFORM_URL` را به آدرس پلتفرم (مثلاً `http://saas-platform.test`) تنظیم کرده باشید.

---

## مرحله ۴: تنظیمات UX از پلتفرم

1. در **saas-platform** بروید به **تنظیمات عمومی پلتفرم** (یا معادل آن در منو).
2. موارد زیر را تنظیم کنید:
   - **نام پلتفرم**
   - **لوگو**
   - **پالت رنگ** (رنگ اصلی، منو، سایدبار، دکمه‌ها و …)
   - **فونت‌ها** (متن، عناوین، اندازه، فونت‌های اضافی)
3. ذخیره کنید.

در **customer-site** (صفحهٔ ورود و پنل ادمین) بعد از حداکثر حدود ۱ ساعت (به‌خاطر کش) همان ظاهر اعمال می‌شود. برای تست فوری می‌توانید کش را خالی کنید (مثلاً بعد از فعال‌سازی مجدد لایسنس، کش UX پاک می‌شود).

خلاصه: **رنگ، فونت، لوگو و نام پلتفرم** را فقط در پلتفرم عوض کنید؛ سایت مشتری آن‌ها را از API می‌گیرد.

---

## مرحله ۵: ماژول‌ها (وبلاگ / فروشگاه)

- در **پلتفرم** برای هر **سایت** می‌توان ماژول (مثلاً blog، shop) را فعال/غیرفعال کرد. خروجی API لایسنس/سایت‌کانفیگ شامل لیست **ماژول‌های مجاز** برای آن سایت است.
- در **customer-site** فعلاً فعال بودن **وبلاگ** و **فروشگاه** علاوه بر لایسنس از **.env** هم خوانده می‌شود:
  - `MODULE_BLOG_ENABLED=true`
  - `MODULE_SHOP_ENABLED=true` (در صورت نیاز فروشگاه)
- اگر لایسنس را درست فعال کرده باشید، در صفحهٔ **لایسنس** سایت مشتری، **ماژول‌های فعال** برگشتی از پلتفرم را می‌بینید. منطق «فقط ماژول‌های برگشتی از API را در سایت مشتری فعال کن» در نسخهٔ بعد قابل اضافه‌شدن است.

برای تست کامل:
- **وبلاگ**: در .env مقدار `MODULE_BLOG_ENABLED=true` بگذارید، یک دسته و یک مطلب بسازید و از داشبورد و منوی ادمین و صفحهٔ وبلاگ در فرانت چک کنید.
- **فروشگاه**: `MODULE_SHOP_ENABLED=true`، یک محصول بسازید و از داشبورد و منو و صفحهٔ فروشگاه تست کنید.

---

## چک‌لیست تست (تا الان)

برای اطمینان از ارتباط درست پلتفرم و سایت مشتری و امکاناتی که تا الان می‌توان به سایت مشتری «داد»، این موارد را مرحله‌به‌مرحله تست کنید.

### الف) تنظیمات پایه

- [ ] **PLATFORM_URL** در .env سایت مشتری تنظیم است (مثلاً `http://saas-platform.test`).
- [ ] در پلتفرم یک **سایت** با دامنهٔ همان customer-site (مثلاً `customer-site.test`) وجود دارد و فعال است.
- [ ] برای آن سایت در پلتفرم **لایسنس** صادر شده و کلید را دارید.

### ب) لایسنس در سایت مشتری

- [ ] در customer-site به **ادمین → لایسنس** رفته و کلید لایسنس (و در صورت نیاز دامنه) را وارد و ذخیره کرده‌اید.
- [ ] پس از ذخیره، وضعیت **فعال** و در صورت پشتیبانی، **ماژول‌های فعال** و **انقضای پشتیبانی** نمایش داده می‌شود (برگشتی از API).

### ج) UX از پلتفرم

- [ ] در پلتفرم **تنظیمات عمومی** (نام، لوگو، رنگ‌ها، فونت‌ها) را تغییر داده‌اید.
- [ ] در سایت مشتری: **صفحهٔ ورود** و **پنل ادمین** (منو، لوگو، نام، رنگ دکمه‌ها و سایدبار) مطابق همان تنظیمات است.
- [ ] در صورت تغییر نکردن، یک‌بار از **لایسنس** دوباره ذخیره کنید تا کش UX خالی شود و صفحه را رفرش کنید.

### د) ورود و دسترسی

- [ ] ورود با **موبایل + رمز** در `http://customer-site.test/login` کار می‌کند.
- [ ] بعد از ورود، **ادمین** به `http://customer-site.test/admin/dashboard` دسترسی دارد و ۴۰۳ نمی‌گیرد.

### ه) داشبورد و محتوا

- [ ] **داشبورد**: تعداد صفحات و مطالب وبلاگ (و در صورت فعال بودن فروشگاه: محصولات و سفارشات) درست نمایش داده می‌شود.
- [ ] یک **صفحه** و در صورت فعال بودن وبلاگ یک **مطلب** بسازید و از داشبورد و منوی ادمین و فرانت بررسی کنید.

### و) ماژول فروشگاه (اختیاری)

- [ ] در .env سایت مشتری `MODULE_SHOP_ENABLED=true` است.
- [ ] در منوی ادمین **محصولات** و **سفارشات** دیده می‌شوند و داشبورد کارت‌های محصولات/سفارشات را نشان می‌دهد.
- [ ] یک محصول تستی بسازید و از فرانت (صفحهٔ فروشگاه) و در صورت وجود، سبد و checkout تست کنید.

---

## جمع‌بندی ارتباط

- **پلتفرم** تعیین می‌کند: این سایت (با این دامنه) چه لایسنس و چه ماژول‌هایی دارد و ظاهر (UX) چطور باشد.
- **سایت مشتری** لایسنس را یک‌بار (یا بعد از تغییر) با API چک می‌کند و UX را از همان API می‌گیرد و کش می‌کند.
- **محتوا** (صفحات، پست‌ها، محصولات، سفارشات) فقط در دیتابیس **سایت مشتری** است و از پنل همان سایت مدیریت می‌شود.

با انجام مرحله‌ها و چک‌لیست بالا می‌توانید مطمئن شوید تا الان چه امکاناتی از پلتفرم به سایت مشتری می‌رسد و چطور آن‌ها را تست کنید.
